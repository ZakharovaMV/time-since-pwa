<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Сколько прошло" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png" />
  <title>Сколько прошло с даты</title>
  <style>
    :root { font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #f6f6f7; color: #111; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 18px; }
    .card { background: #fff; border-radius: 14px; padding: 16px; box-shadow: 0 6px 18px rgba(0,0,0,.06); }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .row { display: grid; grid-template-columns: 1fr; gap: 10px; }
    label { font-size: 13px; color: #555; }
    input { width: 100%; font-size: 16px; padding: 12px; border-radius: 12px; border: 1px solid #ddd; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }
    .item { background: #fafafa; border: 1px solid #eee; border-radius: 12px; padding: 12px; }
    .k { font-size: 12px; color: #666; margin-bottom: 6px; }
    .v { font-size: 20px; font-weight: 650; }
    .hint { font-size: 12px; color: #666; margin-top: 10px; line-height: 1.35; }
    .warn { margin-top: 12px; color: #a00000; font-size: 13px; display: none; }
    button { margin-top: 12px; width: 100%; border: 0; border-radius: 12px; padding: 12px; font-size: 16px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Сколько прошло с даты</h1>

      <div class="row">
        <div>
          <label for="dt">Выберите дату и время</label>
          <input id="dt" type="datetime-local" />
        </div>
      </div>

      <div class="grid" id="results">
        <div class="item"><div class="k">Годы</div><div class="v" id="years">—</div></div>
        <div class="item"><div class="k">Месяцы</div><div class="v" id="months">—</div></div>
        <div class="item"><div class="k">Дни</div><div class="v" id="days">—</div></div>
        <div class="item"><div class="k">Всего дней</div><div class="v" id="totalDays">—</div></div>
        <div class="item"><div class="k">Всего часов</div><div class="v" id="totalHours">—</div></div>
        <div class="item"><div class="k">Всего минут</div><div class="v" id="totalMinutes">—</div></div>
      </div>

      <div class="warn" id="futureWarn">Вы выбрали дату в будущем — “сколько прошло” будет 0.</div>

      <button type="button" id="nowBtn">Поставить дату: сейчас</button>

      <div class="hint">
        Подсчёт “годы/месяцы/дни” идёт по календарю (как обычно считают возраст/стаж),
        а “всего дней/часов/минут” — по точной разнице во времени.
      </div>
    </div>
  </div>

  <script>
    // Register Service Worker (offline)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(() => {});
      });
    }

    const dt = document.getElementById('dt');
    const futureWarn = document.getElementById('futureWarn');

    const out = {
      years: document.getElementById('years'),
      months: document.getElementById('months'),
      days: document.getElementById('days'),
      totalDays: document.getElementById('totalDays'),
      totalHours: document.getElementById('totalHours'),
      totalMinutes: document.getElementById('totalMinutes'),
    };

    function pad(n){ return String(n).padStart(2,'0'); }

    function nowLocalValue() {
      const d = new Date();
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    function calendarDiff(start, end) {
      let y = end.getFullYear() - start.getFullYear();
      let m = end.getMonth() - start.getMonth();
      let d = end.getDate() - start.getDate();

      if (d < 0) {
        const prevMonth = new Date(end.getFullYear(), end.getMonth(), 0);
        d += prevMonth.getDate();
        m -= 1;
      }
      if (m < 0) {
        m += 12;
        y -= 1;
      }
      if (y < 0) y = m = d = 0;
      return { years: y, months: m, days: d };
    }

    function update() {
      if (!dt.value) return;

      const start = new Date(dt.value);
      const end = new Date();

      if (isNaN(start.getTime())) return;

      if (start > end) {
        futureWarn.style.display = 'block';
        out.years.textContent = '0';
        out.months.textContent = '0';
        out.days.textContent = '0';
        out.totalDays.textContent = '0';
        out.totalHours.textContent = '0';
        out.totalMinutes.textContent = '0';
        return;
      } else {
        futureWarn.style.display = 'none';
      }

      const cal = calendarDiff(start, end);

      const ms = end - start;
      const totalMinutes = Math.floor(ms / 60000);
      const totalHours = Math.floor(ms / 3600000);
      const totalDays = Math.floor(ms / 86400000);

      out.years.textContent = cal.years;
      out.months.textContent = cal.months;
      out.days.textContent = cal.days;
      out.totalDays.textContent = totalDays;
      out.totalHours.textContent = totalHours;
      out.totalMinutes.textContent = totalMinutes;
    }

    document.getElementById('nowBtn').addEventListener('click', () => {
      dt.value = nowLocalValue();
      update();
    });

    dt.addEventListener('input', update);

    (function init(){
      const d = new Date();
      d.setDate(d.getDate() - 1);
      dt.value = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
      update();
      setInterval(update, 1000);
    })();
  </script>
</body>
</html>
